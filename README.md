# mago3D
<strong>mago3D is a Digital Twin Platform</strong>

[Installation and training details](https://gaia3d.atlassian.net/wiki/spaces/education/pages/71892997/mago3D)

## Features
- 2D spatial information management function
- 3D data format support function
- 3D data management function
- Automated 2D/3D spatial information management function
- 3D visualization function
- 3D data operation function
- Interworking with simulation service

## Development Environment
- JAVA (OpenJDK) 11.0.2
- Spring Boot 2.3.0
- PostgreSQL 12
- PostGIS 3.0
- Gradle 6.5.0
- Mybatis
- Lombok
- Thymeleaf
- F4d Converter
- Geoserver 2.17.x
- RabbitMQ 3.8.x
- Gdal 3.x

## Project Composition
- mago3d-admin : Platform (mago3D) administrator
- mago3d-converter : 3D spatial information automation management
- mago3d-user: 2D/3D spatial data inquiry, simulation interlocking, etc.
- common : Management of common functions such as encryption (security) and statistics module
- doc : database schema, development documentation
- html: html design file (generated by npm init)

## Quick Started
- mago3D-CE (mago3D js, mago3D converter)
  ~~~ java
  docker-compose -f docker-compose-ce.yml up -d
  ~~~
- *TOBE...mago3D-EE(mago3Djs, mago3D converter, mago3D CMS)*


## Getting Started

## 1. Install
### 1.1 Common
#### [java](https://jdk.java.net/archive/)
- OpenJDK 11.0.2 (build 11.0.2+9) : 11 version installed

#### [GDAL](https://trac.osgeo.org/osgeo4w/)
- Install OSGeo4W (FOSSGIS for Windows) to install GDAL
- Add system variable <br>
  Path) C:\OSGeo4W64\bin
  
#### [F4D Converter](https://github.com/Gaia3D/F4DConverter/blob/master/install/SetupF4DConverter.msi)
- Installation path: C:\F4DConverterConsole
- Execute the downloaded file to install Converter.
 
### 1.2 docker environment
- To use docker-compose, docker must be installed in advance.
- Execute the following command in the root path of the checkedout project.
~~~ cmd
    docker-compose up -d
~~~
- According to the contents defined in the docker-compose file, database, geoserver, and rabbitmq are created as containers.

### 1.3 General Environment
- If you have configured the development environment with docker-compose in the docker environment of 1.2, you can skip step 1.3.

#### [PostgreSQL] (https://www.enterprisedb.com/downloads/postgres-postgresql-downloads)
- Set to PostgreSQL12 version
- Installation path C:/PostgreSQL/12 <br>
  See doc/database/doc/database/
- [PostGIS] (https://postgis.net/) set to the latest SQL version

#### [Erlang] (https://www.erlang.org/downloads)
- To install rabbit mq, erlang is required, so first install erlang.
- Click ‘OTP 23.1 Windows 64-bit Binary File’ in the Download OTP 23.1 section to download and run the file.
- Since the component settings will be defaulted, click next to install.
- **If the Visual C++ component installation window appears, check the checkbox and install.**

#### [RabbitMQ](https://www.rabbitmq.com/download.html)
- Check the latest version, and download and install the installation file according to the operating system environment.
    - Environment variable setting
        - Click [Control Panel] → [System and Security] → [System] or [Properties] of [My PC], and then click [Advanced system settings].
        - Click [Environment Variables] on the [Advanced] tab screen of [System Properties].
        - Click [New] on the [Environment Variables] screen and set RABBITMQ_HOME and RabbitMQ installation path in the variable name and variable value fields.
        - After setting the RabbitMQ installation path, select the [Path] variable in the system variables and click the [Edit] button.
        - Click the [New] button and enter %RABBITMQ_HOME%\sbin.
    - Activate the admin plugin
        - To access the admin page, the management plugin must be activated. (Cannot connect when deactivated)
        - To activate the management plugin of RabbitMQ, enter ‘rabbitmq-plugins enable rabbitmq_management’ in the command prompt window to enable it.
        - Restart the command prompt and check whether the plugin is activated with ‘rabbitmq-plugins list’.
    - Admin Settings
        - Access the RabbitMQ admin page (http://localhost:15672).
        - Both ID and password log in as guest.
        - Click the Exchange tab at the top, click Add a new exchanges at the bottom, enter the following, and click the Add exchange button.
            - Name : f4d.converter
            - Type : topic
            - Durability : Durable
        - Click the Queues tab at the top, click Add a new queue at the bottom, enter the following, and click the Add queue button.
            - Type : Classic
            - Name : f4d.converter.queue
            - Durability : Durable
        - To create another administrator account, click Add a user at the bottom of the Admin menu and enter the following to create an administrator account.
            - Username : mago3d
            - Password : mago3d
            - Tags : administrator
        - Click the newly created mago3d account under guest, create Current permissions and Current topic permissions as shown below, enter the password (mago3d) in Update this user, and click the Update user button at the bottom.
            - Current permission
                - Virtual Host : /
                - Configure regexp : .*
                - Write regexp : .*
                - Read regexp : .*
            - Topic permission
                - Virtual Host : /
                - Exchange: f4d.converter
                - Write regexp : .*
                - Read regexp : .*
                
#### IDE Settings
#### [eclipse](https://www.eclipse.org/downloads/download.php?file=/oomph/epp/2019-12/R/eclipse-inst-win64.exe)
- Eclipse IDE 2019-12 (2019-12(4.14.0) or higher installed)<br>
- Eclipse Settings - STS (Spring Tools) Settings <br>
  Help → Eclipse Marketplace → Search 'STS' and install Spring Tools 4
- After running Eclipse, Project Import <br>
  File → import → Gradle → Existing Gradle Project
  
#### intellij
- In order to update static resources without build in the local development environment, the resource path is set as a file path, and the execution of mago3d is executed as bootRun or
Working directory must be set to **$MODULE_WORKING_DIR$** in configuration.


#### [lombok](https://projectlombok.org/)
- If you are using eclipse, you need to install lombok through the process below.
- Run after moving to the download folder
- Search the eclipse installation location [Specify location..] and select the 'eclipse.exe' file.
- install/update clickRick.



## 2. DB creation and initial data registration
- If you have configured the development environment with docker-compose in the docker environment of 1.2, you can skip this process.
- Database & Extensions
- Create a mago3d database. Set up the database for Korean sorting as follows.
~~~ sql
        CREATE DATABASE mago3d
        WITH OWNER = postgres
        ENCODING = 'UTF8'
        TEMPLATE = template0
        TABLESPACE = pg_default
        LC_COLLATE = 'C'
        LC_CTYPE = 'C'
        CONNECTION LIMIT = -1;
~~~
- Execute Extensions in psql (SQL Shell) or pgAdmin.
~~~ sql
        CREATE EXTENSION postgis
~~~
- run sql
    - Execute the sql files in the ddl/dml/index folder in the doc/database path.


## 3. Execution
- Run mago3d-admin project spring boot <br>
  url : http://localhost(:port)/
<pre><code>/mago3d-admin/src/main/java/gaia3d/Mago3DAdminApplication.java</code></pre>

## License
[Apache License Version 2.0] (http://www.apache.org/licenses/LICENSE-2.0.html).
